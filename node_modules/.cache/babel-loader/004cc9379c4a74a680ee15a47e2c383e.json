{"ast":null,"code":"import \"core-js/modules/es.promise.js\";\nimport { createAsyncThunk, createSlice } from '@reduxjs/toolkit';\nimport axios from 'axios';\nexport const loginUser = createAsyncThunk('auth/loginUser', async payload => {\n  try {\n    const response = await axios.post('http://localhost:8080/api/login', payload);\n    console.log(response.status);\n    return response.data;\n  } catch (err) {\n    console.log('am ajuns aici');\n    return Promise.reject({\n      message: 'login fail'\n    });\n  }\n});\nexport const getUser = createAsyncThunk('auth/loginUserWithGoogle', async () => {\n  try {\n    console.log('Start get user');\n    const authToken = localStorage.getItem('token');\n    const response = await axios.get('http://localhost:8080/user/me', {\n      headers: {\n        Authorization: 'Bearer ' + authToken //the token is a variable which holds the token\n\n      }\n    });\n    console.log(\" the user is \" + response);\n    return response.data;\n  } catch (err) {\n    console.log('am ajuns aici');\n    return Promise.reject({\n      message: 'login fail'\n    });\n  }\n});\nexport const updateRoleOfUser = createAsyncThunk('auth/updateRoleOfUser', async payload => {\n  try {\n    console.log('The user chose the role +' + payload);\n    const authToken = localStorage.getItem('token');\n    console.log(\"The token is\" + authToken);\n    const response = await axios.get('http://localhost:8080/refugees/api/dashboard/update-user/' + payload, {\n      headers: {\n        Authorization: 'Bearer ' + authToken //the token is a variable which holds the token\n\n      }\n    });\n    console.log(\" the response is \" + response);\n    return response.data;\n  } catch (err) {\n    console.log('am ajuns aici');\n    return Promise.reject({\n      message: 'login fail'\n    });\n  }\n});\nexport const registerUser = createAsyncThunk('auth/registerUser', async payload => {\n  try {\n    const response = await axios.post('http://localhost:8080/api/register', payload);\n    return response.status;\n  } catch (err) {\n    console.log('am ajuns aici');\n    return Promise.reject({\n      message: 'register fail'\n    });\n  }\n});\nexport const getBookings = createAsyncThunk('auth/getReservations', async () => {\n  const authToken = localStorage.getItem('token');\n  const response = await axios.get('http://127.0.0.1:5500/apps/mocks/reservations.json', {\n    headers: {\n      Authorization: 'Bearer ' + authToken //the token is a variable which holds the token\n\n    }\n  });\n  console.log(\"Get reservations was called\");\n  return response.data;\n});\nexport const getHouses = createAsyncThunk('auth/getHouses', async () => {\n  const authToken = localStorage.getItem('token');\n  const response = await axios.get('http://localhost:8080/refugees/api/dashboard/houses', {\n    headers: {\n      Authorization: 'Bearer ' + authToken //the token is a variable which holds the token\n\n    }\n  });\n  console.log(\"Get houses was called\");\n  return response.data;\n});\nexport const saveHouse = createAsyncThunk('auth/addPlace', async payload => {\n  try {\n    console.log('adding a new house');\n    const authToken = localStorage.getItem('token');\n    const response = await axios.post('http://localhost:8080/refugees/api/dashboard/save-house', payload, {\n      headers: {\n        Authorization: 'Bearer ' + authToken //the token is a variable which holds the token\n\n      }\n    });\n    return response.status;\n  } catch (err) {\n    console.log('am ajuns aici');\n    return Promise.reject({\n      message: 'Save new place failed'\n    });\n  }\n});\nconst initialState = {\n  restaurants: [],\n  restaurant: {},\n  isLoggedIn: false,\n  user: undefined,\n  reviews: [],\n  review: {},\n  toastError: '',\n  toastSuccess: '',\n  image: '',\n  reservations: [],\n  houses: []\n}; // Then, handle actions in your reducers:\n\nexport const authSlice = createSlice({\n  name: 'auth',\n  initialState,\n  reducers: {\n    logout(state) {\n      console.log('logging out');\n      state.isLoggedIn = false;\n      sessionStorage.removeItem(\"token\");\n    },\n\n    setIsLoggedIn(state) {\n      state.isLoggedIn = true;\n    },\n\n    setToastSuccess(state, action) {\n      state.toastSuccess = action.payload;\n    },\n\n    setUser(state, action) {\n      state.user = action.payload;\n    },\n\n    setToastError(state, action) {\n      state.toastError = action.payload;\n    }\n\n  },\n  // standard reducer logic, with auto-generated action types per reducer\n  extraReducers: builder => {\n    // Add reducers for additional action types here, and handle loading state as needed\n    builder.addCase(loginUser.fulfilled, (state, response) => {\n      // Set is Logged in to true\n      console.log('login success');\n      state.isLoggedIn = true;\n      state.user = response.payload;\n      authSlice.caseReducers.setToastSuccess(state, {\n        payload: 'Login successful!',\n        type: 'toast'\n      });\n    });\n    builder.addCase(loginUser.rejected, state => {\n      // Set is Logged in to false\n      state.isLoggedIn = false;\n      console.log('login reject');\n      authSlice.caseReducers.setToastError(state, {\n        payload: 'Login failed! Wrong credentials',\n        type: 'toast'\n      });\n    });\n    builder.addCase(registerUser.fulfilled, state => {\n      // Set is Logged in to true\n      console.log('success baby');\n      authSlice.caseReducers.setToastSuccess(state, {\n        payload: 'Register successful!',\n        type: 'toast'\n      });\n    });\n    builder.addCase(registerUser.rejected, state => {\n      // Set is Logged in to true\n      console.log('success baby');\n      authSlice.caseReducers.setToastError(state, {\n        payload: 'Register failed!',\n        type: 'toast'\n      });\n    });\n    builder.addCase(getBookings.fulfilled, (state, response) => {\n      // Add reservations to the slice array\n      state.reservations = response.payload;\n      console.log(state.reservations);\n    });\n    builder.addCase(saveHouse.fulfilled, (state, response) => {\n      // Set is Logged in to true\n      console.log('save place success');\n      authSlice.caseReducers.setToastSuccess(state, {\n        payload: 'Add accomodation successful!',\n        type: 'toast'\n      });\n    });\n    builder.addCase(saveHouse.rejected, state => {\n      // Set is Logged in to false\n      console.log('save place reject');\n      authSlice.caseReducers.setToastError(state, {\n        payload: 'Add accomodation failed!',\n        type: 'toast'\n      });\n    });\n    builder.addCase(getHouses.fulfilled, (state, response) => {\n      // Set is Logged in to true\n      console.log('save place success');\n      state.houses = response.payload;\n    });\n    builder.addCase(getUser.fulfilled, (state, response) => {\n      // Set is Logged in to true\n      state.user = response.payload;\n      localStorage.setItem(\"token\", state.user.token);\n      authSlice.caseReducers.setToastSuccess(state, {\n        payload: 'Login with google success!',\n        type: 'toast'\n      });\n    });\n    builder.addCase(getUser.rejected, (state, response) => {\n      // Set is Logged in to true\n      authSlice.caseReducers.setToastError(state, {\n        payload: 'Login with google failed!',\n        type: 'toast'\n      });\n    });\n    builder.addCase(updateRoleOfUser.fulfilled, state => {\n      console.log('save role reject');\n      authSlice.caseReducers.setToastSuccess(state, {\n        payload: 'Set role success!',\n        type: 'toast'\n      });\n    });\n    builder.addCase(updateRoleOfUser.rejected, state => {\n      console.log('save role reject');\n      authSlice.caseReducers.setToastError(state, {\n        payload: 'Set role failed!',\n        type: 'toast'\n      });\n    });\n  }\n});","map":null,"metadata":{},"sourceType":"module"}