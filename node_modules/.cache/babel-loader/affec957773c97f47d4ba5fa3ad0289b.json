{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Alice-Maria\\\\Downloads\\\\licenta-fe\\\\libs\\\\authentication\\\\src\\\\containers\\\\oauth2\\\\OauthRedirect.js\";\nimport \"core-js/modules/es.array.iterator.js\";\nimport \"core-js/modules/web.dom-collections.iterator.js\";\nimport \"core-js/modules/es.regexp.exec.js\";\nimport \"core-js/modules/es.string.replace.js\";\nimport \"core-js/modules/es.regexp.constructor.js\";\nimport \"core-js/modules/es.regexp.to-string.js\";\nimport \"core-js/modules/es.string.search.js\";\nimport \"core-js/modules/es.promise.js\";\nimport React, { Component, useEffect, useState } from 'react';\nimport { connect, useDispatch, useSelector } from 'react-redux';\nimport { Navigate } from 'react-router-dom';\nimport { authSlice } from '../redux/slice';\nimport { loginUserWithGoogle } from '../redux/slice';\nimport { useLocation, useParams } from \"react-router-dom\";\nimport axios from 'axios';\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst OAuth2RedirectHandler = () => {\n  const location = useLocation();\n  const params = useParams();\n  const dispatch = useDispatch();\n  const [returnPath, setReturnPath] = useState( /*#__PURE__*/_jsxDEV(_Fragment, {}, void 0, false));\n\n  const getUrlParameter = name => {\n    name = name.replace(/[\\[]/, '\\\\[').replace(/[\\]]/, '\\\\]');\n    var regex = new RegExp('[\\\\?&]' + name + '=([^&#]*)');\n    var results = regex.exec(location.search);\n    return results === null ? '' : decodeURIComponent(results[1].replace(/\\+/g, ' '));\n  };\n\n  useEffect(async () => {\n    let pathToNavigate = /*#__PURE__*/_jsxDEV(_Fragment, {}, void 0, false);\n\n    const token = getUrlParameter('token');\n\n    if (token) {\n      localStorage.setItem(\"token\", token);\n      dispatch(authSlice.actions.setIsLoggedIn());\n\n      try {\n        console.log('Started logging with google');\n        const response = await dispatch(loginUserWithGoogle());\n        const user = response.data;\n        const role = user.role;\n        console.log(\" the user is \" + role);\n\n        if (role == \"ROLE_USER\") {\n          pathToNavigate = /*#__PURE__*/_jsxDEV(Navigate, {\n            to: {\n              pathname: \"/select-role\"\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 44,\n            columnNumber: 38\n          }, this);\n        } else {\n          if (role === 'ROLE_GUEST') {\n            pathToNavigate = /*#__PURE__*/_jsxDEV(Navigate, {\n              to: {\n                pathname: \"/houses-guest\"\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 48,\n              columnNumber: 42\n            }, this);\n          } else {\n            pathToNavigate = /*#__PURE__*/_jsxDEV(Navigate, {\n              to: {\n                pathname: \"/bookings\"\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 51,\n              columnNumber: 42\n            }, this);\n          }\n        }\n      } catch (err) {\n        console.log('am ajuns aici');\n      }\n    }\n\n    console.log(pathToNavigate);\n    setReturnPath(pathToNavigate);\n  }, []);\n  return returnPath;\n};\n\nexport default OAuth2RedirectHandler;","map":null,"metadata":{},"sourceType":"module"}